<!DOCTYPE html>
<html>
  <head>
    <title>Wheelchair Accessibility Map</title>
    <meta charset="utf-8" />
    <style>
      #map {
        height: 80vh;
        width: 100%;
      }
      #dashboard-box {
        height: 50vh;
        width: 100%;
        background-color: #f0f0f0;
        border-top: 2px solid #ccc;
        box-sizing: border-box;
      }
      #buttons {
        margin: 10px;
      }
      button {
        font-size: 16px;
        margin: 5px;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <h2>‚ôø Wheelchair Accessibility + Navigation</h2>

    <div id="buttons">
      <button onclick="setTarget(1)">start</button>
      <input id="lat1" placeholder="start latitude" />
      <input id="lng1" placeholder="start longitude" />

      <button onclick="setTarget(2)">destination</button>
      <input id="lat2" placeholder="destination latitude" />
      <input id="lng2" placeholder="destination longitude" />
    </div>

    <div id="map"></div>

    <div>
      <h2>Route Selection</h2>
      <button onclick="showDrivingRoute()">Efficent Mode (Fastest Route)</button>
      <button onclick="showTransitRoute()">Safe Mode (Public Transportation)</button>
      <p id="route-output" style="font-weight: bold; font-size: 18px;"></p>
    </div>

    <div>
      <h2>Real-Time Object Detection</h2>
      <p id="connect-camera" style="font-weight: bold; font-size: 18px;"></p>
      <video id="camera" autoplay playsinline></video><br>
      <button onclick="startCamera()">Real-Time Object Detection</button>
      <h4>Customize Alert System</h4>
      <label><input type="checkbox" name="sound" checked> Sound Alerts</label><br>
      <label><input type="checkbox" name="vibration"> Vibration</label>
      <button onclick="playAlert()">Play Alert Sound</button>
      <audio id="alert-sound" src="https://actions.google.com/sounds/v1/alarms/spaceship_alarm.ogg" preload="auto"></audio>
      <button type="submit">Save Settings</button>
    </div>

    <div>
      <h2>Support Systems</h2>
      <button onclick="contactsystem(this)">Contact Boston 311</button>
      <button onclick="contactsystem(this)">Contact Wonders in Reach</button>
      <button onclick="contactsystem(this)">ADA Ramp Access Form</button>
      <p id="contact-support" style="font-weight: bold; font-size: 18px;"></p>
    </div>

    <div>
      <h2>Contribute Data</h2>
      <button onclick="contributedatasystem(this)">Click here to create more boundless cities!</button>
      <p id="join-the-movement" style="font-weight: bold; font-size: 18px;"></p>
    </div>

    <script src="script.js"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB-I-dlRuOiijTcNZkubsPTv4Pl1AW7GFI&callback=initMap"></script>
    <script>
      function startCamera() {
        const video = document.getElementById('camera');
        navigator.mediaDevices.getUserMedia({ video: true, audio: false })
          .then(stream => {
            video.srcObject = stream;
          })
          .catch(error => {
            console.error('Failed to access camera:', error);
            alert('Failed to access camera.');
          });
      }
      function playAlert() {
        const alertSound = document.getElementById('alert-sound');
        alertSound.play();
        }
      
      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 15,
          center: origin,
        });
  
        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer({ map: map });
  
        calculateRoute();
  
        // Ïã§ÏãúÍ∞Ñ ÏúÑÏπò Ï∂îÏ†Å
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition(position => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
  
            const distance = getDistance(lat, lng, destination.lat, destination.lng);
  
            document.getElementById("status").textContent =
              `ÌòÑÏû¨ ÏúÑÏπò: (${lat.toFixed(5)}, ${lng.toFixed(5)}), Î™©Ï†ÅÏßÄÍπåÏßÄ Í±∞Î¶¨: ${distance.toFixed(1)}m`;
  
            if (distance <= 100 && !alerted) {
              alerted = true;
              alert("üéØ Î™©Ï†ÅÏßÄÍπåÏßÄ 100m Ïù¥ÎÇ¥ÏûÖÎãàÎã§!");
              document.getElementById("alert-sound").play();
            }
          }, error => {
            document.getElementById("status").textContent = "ÏúÑÏπò Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.";
          });
        } else {
          alert("Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÏúÑÏπò ÏÑúÎπÑÏä§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.");
        }
      }
      // Í≤ΩÎ°ú Í≥ÑÏÇ∞
      function calculateRoute() {
        directionsService.route(
          {
            origin: origin,
            destination: destination,
            travelMode: google.maps.TravelMode.WALKING,
          },
          (response, status) => {
            if (status === "OK") {
              directionsRenderer.setDirections(response);
            } else {
              alert("Í≤ΩÎ°ú Í≥ÑÏÇ∞ Ïã§Ìå®: " + status);
            }
          }
        );
      }
      function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371000;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a =
          Math.sin(dLat / 2) ** 2 +
          Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
          Math.sin(dLon / 2) ** 2;
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c;
      }
    </script>
  </body>
</html>
